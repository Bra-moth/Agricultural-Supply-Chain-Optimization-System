{% extends "base.html" %} {% block title %}{{ crop.name }} Details - Agri-SCM{%
endblock %} {% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div
          class="card-header d-flex justify-content-between align-items-center"
        >
          <h3 class="mb-0">{{ crop.name }} - {{ crop.variety }}</h3>
          <div>
            <a
              href="{{ url_for('edit_crop', crop_id=crop.id) }}"
              class="btn btn-primary"
            >
              <i class="bi bi-pencil"></i> Edit
            </a>
            {% if crop.status == 'ready_for_harvest' %}
            <button
              class="btn btn-success"
              onclick="harvestCrop({{ crop.id }})"
            >
              <i class="bi bi-scissors"></i> Harvest
            </button>
            {% endif %}
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h5>Crop Information</h5>
              <table class="table">
                <tr>
                  <th>Status</th>
                  <td>
                    <span
                      class="badge bg-{{ 'success' if crop.status == 'ready_for_harvest' else 'primary' }}"
                    >
                      {{ crop.status|replace('_', ' ')|title }}
                    </span>
                  </td>
                </tr>
                <tr>
                  <th>Planting Date</th>
                  <td>{{ crop.planting_date.strftime('%Y-%m-%d') }}</td>
                </tr>
                <tr>
                  <th>Expected Harvest</th>
                  <td>{{ crop.expected_harvest_date.strftime('%Y-%m-%d') }}</td>
                </tr>
                <tr>
                  <th>Quantity</th>
                  <td>{{ crop.quantity }} {{ crop.unit }}</td>
                </tr>
                <tr>
                  <th>Notes</th>
                  <td>{{ crop.notes or 'No notes available' }}</td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              {% if crop.image_path %}
              <img
                src="{{ url_for('static', filename='uploads/' + crop.image_path) }}"
                class="img-fluid rounded"
                alt="{{ crop.name }}"
              />
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <!-- Market Information -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0">Market Information</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span>Current Market Price</span>
            <span class="badge bg-success"
              >R{{ market_price }}/{{ crop.unit }}</span
            >
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span>Estimated Value</span>
            <span class="text-success fw-bold"
              >R{{ (market_price * crop.quantity)|round(2) }}</span
            >
          </div>
        </div>
      </div>

      <!-- Growth Timeline -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Growth Timeline</h5>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker bg-success"></div>
              <div class="timeline-content">
                <h6 class="mb-0">Planted</h6>
                <small class="text-muted"
                  >{{ crop.planting_date.strftime('%Y-%m-%d') }}</small
                >
              </div>
            </div>
            {% if crop.status == 'growing' %}
            <div class="timeline-item">
              <div class="timeline-marker bg-primary"></div>
              <div class="timeline-content">
                <h6 class="mb-0">Growing</h6>
                <small class="text-muted">In progress</small>
              </div>
            </div>
            {% endif %} {% if crop.status == 'ready_for_harvest' %}
            <div class="timeline-item">
              <div class="timeline-marker bg-warning"></div>
              <div class="timeline-content">
                <h6 class="mb-0">Ready for Harvest</h6>
                <small class="text-muted">Now</small>
              </div>
            </div>
            {% endif %} {% if crop.status == 'harvested' %}
            <div class="timeline-item">
              <div class="timeline-marker bg-success"></div>
              <div class="timeline-content">
                <h6 class="mb-0">Harvested</h6>
                <small class="text-muted"
                  >{{ crop.harvest_date.strftime('%Y-%m-%d') }}</small
                >
              </div>
            </div>
            {% endif %} {% if crop.status != 'harvested' %}
            <div class="timeline-item">
              <div class="timeline-marker bg-light"></div>
              <div class="timeline-content">
                <h6 class="mb-0">Expected Harvest</h6>
                <small class="text-muted"
                  >{{ crop.expected_harvest_date.strftime('%Y-%m-%d') }}</small
                >
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block styles %}
<style>
  .timeline {
    position: relative;
    padding: 20px 0;
  }

  .timeline-item {
    position: relative;
    padding-left: 40px;
    margin-bottom: 20px;
  }

  .timeline-marker {
    position: absolute;
    left: 0;
    top: 0;
    width: 15px;
    height: 15px;
    border-radius: 50%;
  }

  .timeline-item:not(:last-child):before {
    content: "";
    position: absolute;
    left: 7px;
    top: 15px;
    height: calc(100% + 5px);
    width: 2px;
    background-color: #e9ecef;
  }

  .timeline-content {
    padding-left: 15px;
  }
</style>
{% endblock %} {% block scripts %}
<script>
  function harvestCrop(cropId) {
    if (confirm("Are you sure you want to mark this crop as harvested?")) {
      fetch(`/api/harvest_crop/${cropId}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            location.reload();
          } else {
            alert("Failed to harvest crop: " + data.error);
          }
        });
    }
  }
</script>
{% endblock %}
